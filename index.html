<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!--CSS for Bootstrap -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />
        <!--JS for Bootstrap -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	<!--CSS fo Customize -->
	<link rel="stylesheet" href="style.css">
	
        <title>Gearcal</title>
	
        <script src="Gear.js"></script>  <!--歯車計算用jsファイル-->
    </head>
    
    <body>
        <div class="container-fluid my-container">
	<br>
        <h1 class="myh1">歯車諸元計算ソフト</h1>
        <p id="introp">
	  <br>
          標準平歯車の諸元を計算します。
	  <br>
	  バックラッシが適正となるよう中心距離を設定してください。
        </p>
	<br>
        <form name="inputpal" class="form-group my-form form-inline">
	    <label for="z1">入力歯車の歯数</label>
            <input class="form-control my-input" type="number" step="any" name="z1" value=""><br>
	    <label for="z2">出力歯車の歯数</label>
            <input class="form-control my-input" type="number" step="any" name="z2" value=""><br>
	    <label for="z1">モジュール</label>
            <input class="form-control my-input" type="number" step="any" name="m" value=""><br>
	    <label for="z1">中心距離</label>
            <input class="form-control my-input" type="number" step="any" name="dis" value=""><br>
	    <input type="button" class="btn btn-default" value="計算" onclick="cal()">
	    <a id="DLlink" download="result.txt"><button type="button" class="btn btn-info">結果を.txtで保存する</button></a>   <!--結果をテキストファイルでDLするボタンを配置-->
        </form>
        
        <br>
        <div id="result1"></div>  <!-- 結果が出力されるdiv要素 -->

	<br>
	</div>
	</div>
        <script>
	
            var DLpartv = document.getElementById("DLlink").style;    
            DLpartv.visibility = "hidden";                             /*結果をDLするボタンを非表示*/

	  
          function cal(){  

	    var z1 = Number(document.inputpal.z1.value);           /*テキストボックスの値をnum型に変換(計算でstr型として処理されるのを防ぐため)*/
            var z2 = Number(document.inputpal.z2.value);
            var m = Number(document.inputpal.m.value);
            var dis = Number(document.inputpal.dis.value);
	  
            var write = document.getElementById("result1");

              write.innerHTML = "速比:"+Math.round(Gear.u(z1,z2)*10e5)/10e5+"<br>";
              write.insertAdjacentHTML("beforeend","入力歯車の基準ピッチ円直径:"+Math.round(Gear.d(m,z1)*10e5)/10e5+"[mm]<br>");
              write.insertAdjacentHTML("beforeend","出力歯車の基準ピッチ円直径:"+Math.round(Gear.d(m,z2)*10e5)/10e5+"[mm]<br>");
              write.insertAdjacentHTML("beforeend","入力歯車の噛み合いピッチ円直径:"+Math.round(Gear.db(z1,z1,z2,dis)*10e5)/10e5+"[mm]<br>");
              write.insertAdjacentHTML("beforeend","出力歯車の噛み合いピッチ円直径:"+Math.round(Gear.db(z2,z1,z2,dis)*10e5)/10e5+"[mm]<br>");
              write.insertAdjacentHTML("beforeend","噛み合い圧力角:"+Math.round(Gear.ab(m,z1,z2,dis)*10e5)/10e5+"[deg]<br>");
              write.insertAdjacentHTML("beforeend","入力歯車の公差単位:"+Math.round(Gear.W(m,z1)*10e5)/10e5+"[μm]<br>");
              write.insertAdjacentHTML("beforeend","出力歯車の公差単位:"+Math.round(Gear.W(m,z2)*10e5)/10e5+"[μm]<br>");
              write.insertAdjacentHTML("beforeend","最大バックラッシ:"+Math.round(Gear.cmax(m,z1,z2)*10e5)/10e5+"[mm]<br>");
              write.insertAdjacentHTML("beforeend","最小バックラッシ:"+Math.round(Gear.cmin(m,z1,z2)*10e5)/10e5+"[mm]<br>");
              write.insertAdjacentHTML("beforeend","ピッチ円上バックラッシ:"+Math.round(Gear.cn(m,z1,z2,dis)*10e5)/10e5+"[mm]<br>");
              write.insertAdjacentHTML("beforeend","中心距離増加係数"+Math.round(Gear.y(m,z1,z2,dis)*10e5)/10e5+"<br>");
              write.insertAdjacentHTML("beforeend","入力歯車の歯先円直径:"+Math.round(Gear.dk(m,z1,z1,z2,dis)*10e5)/10e5+"[mm]<br>");
              write.insertAdjacentHTML("beforeend","出力歯車の歯車先円直径:"+Math.round(Gear.dk(m,z2,z1,z2,dis)*10e5)/10e5+"[mm]<br>");
              write.insertAdjacentHTML("beforeend","入力歯車の基礎円半径:"+Math.round(Gear.rg(m,z1)*10e5)/10e5+"[mm]<br>");
              write.insertAdjacentHTML("beforeend","出力歯車の基礎円半径:"+Math.round(Gear.rg(m,z2)*10e5)/10e5+"[mm]<br>");
              write.insertAdjacentHTML("beforeend","噛み合い長さ:"+Math.round(Gear.L(m,z1,z2,dis)*10e5)/10e5+"[mm]<br>");
              write.insertAdjacentHTML("beforeend","法線ピッチ:"+Math.round(Gear.te(m)*10e5)/10e5+"[mm]<br>");
              write.insertAdjacentHTML("beforeend","噛み合い率:"+Math.round(Gear.mrt(m,z1,z2,dis)*10e5)/10e5+"<br>");
	      if (Gear.isCnNG(m,z1,z2,dis)){
		  write.insertAdjacentHTML("beforeend",'<p id="CnNG">バックラッシが不適です</p>');
	      }



            var allresult = write.innerText;                         /*出力された結果を読み込み*/
            DLpartv.visibility="visible";                            /*結果をDLするボタンを表示*/

            var blob = new Blob([allresult],{"type":"text/plain"});  /*結果をテキストデータのバイナリに変換*/
            var url = URL.createObjectURL(blob);                     /*バイナリファイルのURLを作成*/
            document.getElementById("DLlink").href=url;              /*結果をDLするボタンにhref属性を付与し作成したURLを与える*/

            }
      
        </script>    

    </body>
  
</html>
