<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!--CSS for Bootstrap -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <!--JS for Bootstrap -->
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
	<!--CSS for Customize -->
	<link rel="stylesheet" href="style.css">
	
        <title>Gearcal</title>
	
        <script src="Gear.js"></script>  <!--歯車計算用jsファイル-->
    </head>
    
    <body>
        
        <div class="container-fluid my-container">
	<br>
        <h1 class="myh1">歯車諸元計算ソフト</h1>
        <p id="introp">
	  <br>
          標準平歯車の諸元を計算します。
	  <br>
	  バックラッシが適正となるよう中心距離を設定してください。
        </p>
	
	<br>
	
	<div class="dropdown my-dropdown">       <!--減速機の段数を選択-->
	  <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
	  <span id="speed"> 一段減速機</span>    <!--現在の変速機の段数を表示するspan-->
	    <span class="caret"></span>
	  </button>
	  <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
	    <a class="dropdown-item" onclick="selectspeed(1)">一段減速機</a>
	    <a class="dropdown-item" onclick="selectspeed(2)">二段減速機</a>
	    <a class="dropdown-item" onclick="selectspeed(3)">三段減速機</a>
	    <a class="dropdown-item" onclick="selectspeed(4)">四段減速機</a>
	  </ul>
	</div>
	
	<br>
	
        <form class="form-group my-form form-inline">       <!--ページを読み込む際に最初に表示されるform(selectspeed(s)によって適宜編集される)-->
	  <div id="Gearform">
	    <label for="z1">入力歯車の歯数</label>
            <input class="form-control my-input" type="number" step="any" id="z1" value=""><br>
	    <label for="z2">出力歯車の歯数</label>
            <input class="form-control my-input" type="number" step="any" id="z2" value=""><br>
	    <label for="m1">モジュール</label>
            <input class="form-control my-input" type="number" step="any" id="m1" value=""><br>
	    <label for="dis1">中心距離</label>
            <input class="form-control my-input" type="number" step="any" id="dis1" value=""><br>
	    </div>
	    <br>
	
        </form>

	<div id="btnarea">
	<button type="button" class="btn btn-dark" onclick="cal()">計算</button>
	<a id="DLlink" download="result.txt"><button type="button" class="btn btn btn-outline-dark">結果を.txtで保存する</button></a>   <!--結果をテキストファイルでDLするボタンを配置-->
	</div>
        
        <br>
	
	<div id="result">         <!--結果が出力されるdiv(cal()によって編集される)(DLされる内容もこれ)-->
        <div id="result1"></div>  
	<div id="result2"></div>
	<div id="result3"></div>
	<div id="result4"></div>
	<div id="total"></div>
	</div>
	
	<br>
	</div>
	</div>
	
        <script>
	
          var DLpartv = document.getElementById("DLlink").style;    
          DLpartv.visibility = "hidden";                             /*結果をDLするボタンを非表示*/

	  var speed=1;                                                /*減速機の段数を示すグローバル変数(初期値は1でdropdownにて変更)*/

	  
          function cal(){                                             /*計算buttonが押されたときに実行される関数*/
	      
	      document.getElementById("result1").innerHTML=("");     /*結果のdivを一旦初期化*/
	      document.getElementById("result2").innerHTML=("");
	      document.getElementById("result3").innerHTML=("");
	      document.getElementById("result4").innerHTML=("");

	      var totalU=1;                                          /*全減速比を1で初期化*/
	      
	      for(var i=1;i<=speed;i++){                             /*各段ごとに計算&出力をするためforで回す*/
		  
		  var z1 = Number(document.getElementById("z"+(2*i-1)).value);           /*テキストボックスの値をnum型に変換(計算でstr型として処理されるのを防ぐため)*/
		  var z2 = Number(document.getElementById("z"+(2*i)).value);
		  var m = Number(document.getElementById("m"+i).value);
		  var dis = Number(document.getElementById("dis"+i).value);
		  
		  var write = document.getElementById("result"+i);
		  
		  write.innerHTML = "速比:"+Math.round(Gear.u(z1,z2)*10e5)/10e5+"<br>";  /*各値の計算と出力(Gear.jsのGearオブジェクトを使用)*/
		  totalU *= Gear.u(z1,z2); /*全減速比(初期値1に現在の段の即火をかけ合わせる)*/
		  write.insertAdjacentHTML("beforeend","入力歯車の基準ピッチ円直径:"+Math.round(Gear.d(m,z1)*10e5)/10e5+"[mm]<br>");
		  write.insertAdjacentHTML("beforeend","出力歯車の基準ピッチ円直径:"+Math.round(Gear.d(m,z2)*10e5)/10e5+"[mm]<br>");
		  write.insertAdjacentHTML("beforeend","入力歯車の噛み合いピッチ円直径:"+Math.round(Gear.db(z1,z1,z2,dis)*10e5)/10e5+"[mm]<br>");
		  write.insertAdjacentHTML("beforeend","出力歯車の噛み合いピッチ円直径:"+Math.round(Gear.db(z2,z1,z2,dis)*10e5)/10e5+"[mm]<br>");
		  write.insertAdjacentHTML("beforeend","噛み合い圧力角:"+Math.round(Gear.ab(m,z1,z2,dis)*10e5)/10e5+"[deg]<br>");
		  write.insertAdjacentHTML("beforeend","入力歯車の公差単位:"+Math.round(Gear.W(m,z1)*10e5)/10e5+"[μm]<br>");
		  write.insertAdjacentHTML("beforeend","出力歯車の公差単位:"+Math.round(Gear.W(m,z2)*10e5)/10e5+"[μm]<br>");
		  write.insertAdjacentHTML("beforeend","最大バックラッシ:"+Math.round(Gear.cmax(m,z1,z2)*10e5)/10e5+"[mm]<br>");
		  write.insertAdjacentHTML("beforeend","最小バックラッシ:"+Math.round(Gear.cmin(m,z1,z2)*10e5)/10e5+"[mm]<br>");
		  write.insertAdjacentHTML("beforeend","ピッチ円上バックラッシ:"+Math.round(Gear.cn(m,z1,z2,dis)*10e5)/10e5+"[mm]<br>");
		  write.insertAdjacentHTML("beforeend","中心距離増加係数"+Math.round(Gear.y(m,z1,z2,dis)*10e5)/10e5+"<br>");
		  write.insertAdjacentHTML("beforeend","入力歯車の歯先円直径:"+Math.round(Gear.dk(m,z1,z1,z2,dis)*10e5)/10e5+"[mm]<br>");
		  write.insertAdjacentHTML("beforeend","出力歯車の歯車先円直径:"+Math.round(Gear.dk(m,z2,z1,z2,dis)*10e5)/10e5+"[mm]<br>");
		  write.insertAdjacentHTML("beforeend","入力歯車の基礎円半径:"+Math.round(Gear.rg(m,z1)*10e5)/10e5+"[mm]<br>");
		  write.insertAdjacentHTML("beforeend","出力歯車の基礎円半径:"+Math.round(Gear.rg(m,z2)*10e5)/10e5+"[mm]<br>");
		  write.insertAdjacentHTML("beforeend","噛み合い長さ:"+Math.round(Gear.L(m,z1,z2,dis)*10e5)/10e5+"[mm]<br>");
		  write.insertAdjacentHTML("beforeend","法線ピッチ:"+Math.round(Gear.te(m)*10e5)/10e5+"[mm]<br>");
		  write.insertAdjacentHTML("beforeend","噛み合い率:"+Math.round(Gear.mrt(m,z1,z2,dis)*10e5)/10e5+"<br>");
		  
		  if (Gear.isCnNG(m,z1,z2,dis)){                                                     　　　　　　　　　　　　　 /*バックラッシが適正か判断*/
		      write.insertAdjacentHTML("beforeend",'<p id="CnNG">バックラッシが不適です</p>');
		  }
		  else{
		      write.insertAdjacentHTML("beforeend",'<p id="CnOK">バックラッシは適正です</p>');
		  }

		  

	      }
	     
	      document.getElementById("total").innerHTML=("全減速比:"+Math.round(totalU*10e5)/10e5+"(1/u:"+Math.round(1/totalU*10e3)/10e3+")");      /*全減速比を出力*/
              var allresult = document.getElementById("result").innerText;                         /*出力された結果を読み込み*/
              DLpartv.visibility="visible";                                                        /*結果をDLするボタンを表示*/
	      
              var blob = new Blob([allresult],{"type":"text/plain"});                              /*結果をテキストデータのバイナリに変換*/
              var url = URL.createObjectURL(blob);                                                 /*バイナリファイルのURLを作成*/
              document.getElementById("DLlink").href=url;                                          /*結果をDLするボタンにhref属性を付与し作成したURLを与える*/
            }

	  function selectspeed(s){                                                                 /*段数選択によって発動する関数*/

	      speed = s;                                                                           /*グローバル変数speedに選択された減速機の段数を代入*/

	      var write = document.getElementById("speed");
	      var writeform = document.getElementById("Gearform");

	      switch(s){                                                                           /* 現在選択している減速段数を表示し段数によってformを編集する*/
	      case 1:
		  write.innerHTML=("一段減速機");
		  break;
	      case 2:
		  write.innerHTML=("二段減速機");
		  break;
	      case 3:
		  write.innerHTML=("三段減速機");
		  break;
	      case 4:
		  write.innerHTML=("四段減速機");
		  break;
	      }

	      writeform.innerHTML=("");  /*入力フォームを一度初期化*/
	      
	      for(var i=1 ; i<=s ; i++){ /*forでformを段数に応じて生成*/
		  if(s!=1){
		      writeform.insertAdjacentHTML("beforeend","<h4 class='my-h4'>"+tokanzi(i)+"段目"+"</h4>");
		  }
		  var forform =
		      '<label for="z'+(2*i-1)+'">入力歯車の歯数</label>'+
		      '<input class="form-control my-input" type="number" step="any" id="z'+(2*i-1)+'" value=""><br>'+
		      '<label for="z'+(2*i)+'">出力歯車の歯数</label>'+
		      '<input class="form-control my-input" type="number" step="any" id="z'+(2*i)+'" value=""><br>'+
		      '<label for="m'+i+'">モジュール</label>'+
		      '<input class="form-control my-input" type="number" step="any" id="m'+i+'" value=""><br>'+
		      '<label for="dis'+i+'">中心距離</label>'+
		      '<input class="form-control my-input" type="number" step="any" id="dis'+i+'" value=""><br>';
		  writeform.insertAdjacentHTML("beforeend",forform);
	      }
	  }
	  
	  function tokanzi(befText){
	      var txt = new Array("〇","一","二","三","四","五","六","七","八","九");
	      return txt[befText];
	  }
	  
        </script>    

    </body>
  
</html>
